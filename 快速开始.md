# GAC Code 状态栏 - 快速开始

> **快速开始模式**: 使用官方 Claude Code + GAC 状态栏，无需自定义启动脚本

## 📥 下载和安装

### 1. 下载项目

```bash
# 下载到 Claude Code 推荐位置
git clone https://github.com/DrayChou/gaccode-statusline.git ~/.claude/scripts/gaccode.com
cd ~/.claude/scripts/gaccode.com
```

### 2. 安装依赖

```bash
# 确保安装了 Python 3.7+
python --version

# 安装必需的 Python 包
pip install requests pathlib
```

## 🔑 安全配置 API 密钥

### 获取 login_token

1. 访问 [GAC Code 官网](https://gaccode.com)
2. 登录你的账户
3. 打开浏览器开发者工具 (F12)
4. 在网络 (Network) 标签页中找到任何 API 请求
5. 在请求头中找到 `Authorization: Bearer xxxxxx`，复制 `xxxxxx` 部分

### 🛡️ 安全配置方式

**推荐方式1: 配置文件**（最安全）
```bash
# 直接编辑配置文件 examples/launcher-config.json
# 在 platforms.gaccode.login_token 字段添加您的令牌
# 这避免了在命令行历史中暴露密钥

# 验证配置
python platform_manager.py list

# 安全提醒：不要在命令行中直接传递API密钥
```

**方式2: 配置文件**（本地开发）

直接编辑运行时配置文件 `data/config/platform-config.json`：

```json
{
  "platforms": {
    "gaccode": {
      "name": "GAC Code",
      "api_base_url": "https://gaccode.com/api",
      "api_key": "",
      "login_token": "REPLACE-WITH-YOUR-ACTUAL-TOKEN",
      "model": "claude-3-5-sonnet-20241022",
      "small_model": "claude-3-5-haiku-20241022", 
      "enabled": true
    }
  },
  "settings": {
    "default_platform": "gaccode"
  }
}
```

⚠️ **安全提醒**: 
- 配置文件中的真实API密钥会被`.gitignore`排除，不会提交到版本控制
- 推荐使用环境变量避免在文件中存储敏感信息
- 配置完成后请验证敏感信息不会出现在日志中

💡 **注意**: 快速开始模式直接编辑 `data/config/platform-config.json`，跳过配置文件同步机制。

## 🚀 使用方法

### 配置官方 Claude Code 状态栏 (快速开始)

配置你的官方 Claude Code 以显示 GAC API 余额：

1. **配置 Claude Code 状态栏**

   编辑 Claude Code 配置文件：
   - **Windows**: `%USERPROFILE%\.config\claude-code\config.json`
   - **Mac/Linux**: `~/.config/claude-code/config.json`

   ```json
   {
     "statusLine": {
       "type": "command",
       "command": "python ~/.claude/scripts/gaccode.com/statusline.py",
       "refreshInterval": 1000
     }
   }
   ```

2. **启动 Claude Code**

   ```bash
   claude
   ```

   状态栏会自动显示：

   - ✅ GAC API 余额 (自动 fallback 到 GAC Code 平台)
   - 📊 当前模型信息
   - 🌿 Git 分支信息
   - ⏱️ 会话时长

### 高级模式：自定义启动器 (可选)

如果你需要多平台支持和高级会话管理，可以使用自定义启动器：

```bash
# Windows PowerShell
./examples/cc.mp.ps1              # 启动默认平台 (GAC Code)
./examples/cc.mp.ps1 --continue   # 继续上次会话

# Linux/Mac
./examples/cc.mp.sh               # 启动默认平台 (GAC Code)
./examples/cc.mp.sh --continue    # 继续上次会话

# 直接使用 Python launcher
python examples/launcher.py      # 启动默认平台 (GAC Code)
python examples/launcher.py --continue  # 继续上次会话
```

**高级模式配置**: 编辑 `examples/launcher-config.json` (会自动同步到 `data/config/launcher-config.json`)

## 📊 状态栏显示内容

状态栏会显示以下信息：

```
Claude v1.2.3 | claude-3-5-sonnet | Balance:¥45.67 | Git:main | 12:34
```

- **平台信息**: 当前使用的 AI 平台
- **模型信息**: 当前使用的模型
- **余额信息**: API 账户余额
- **Git 信息**: 当前分支和状态
- **时长信息**: 当前会话时长

## 🔧 自定义配置

### 状态栏显示选项

编辑 `data/config/statusline-config.json`：

```json
{
  "show_balance": true, // 显示余额信息
  "show_subscription": false, // 显示订阅信息
  "show_git_branch": true, // 显示 Git 分支
  "show_session_duration": true, // 显示会话时长
  "layout": "single_line", // 布局方式: single_line 或 multi_line
  "refresh_interval": 1000 // 刷新间隔 (毫秒)
}
```

## 🚨 常见问题

### Q: 状态栏不显示余额？

**A**: 检查以下几点：

1. `login_token` 是否正确配置
2. 网络连接是否正常
3. GAC Code 账户是否有效

### Q: Claude Code 找不到状态栏脚本？

**A**: 确保：

1. Python 路径正确
2. 脚本路径使用绝对路径
3. Python 依赖已安装

### Q: 怎样测试状态栏是否工作？

**A**: 快速开始模式测试：

```bash
# 进入项目目录
cd ~/.claude/scripts/gaccode.com

# 基础测试（不使用真实API）
echo '{"session_id":"test-official-claude","model":{"display_name":"Claude 3.5 Sonnet"}}' | python statusline.py

# 测试2位十六进制UUID前缀检测（GAC Code = 01前缀）
echo '{"session_id":"01abcdef-1234-5678-9012-123456789abc","model":{"display_name":"Test"}}' | python statusline.py

# 测试平台检测机制
python -c "from data.session_manager import detect_platform_from_session_id; print(detect_platform_from_session_id('01abcdef-1234-5678-9012-123456789abc'))"
```

应该看到类似输出：
```
Model:Claude 3.5 Sonnet Time:13:23:45 Today:$27.49 GAC.B:9535/12000 Git:main
```

**安全测试**:
```bash
# 验证敏感信息不会出现在输出中（API密钥应该被屏蔽）
python platform_manager.py list

# 测试UUID前缀检测（应返回gaccode）
python -c "from data.session_manager import detect_platform_from_session_id; print('Platform:', detect_platform_from_session_id('01abcdef-1234-5678-9012-123456789abc'))"
```

### Q: 想要使用其他 AI 平台？

**A**:

1. 在 `launcher-config.json` 中配置对应平台的 API key
2. 设置 `enabled: true`
3. 使用启动器指定平台：`./cc.mp.ps1 dp` (DeepSeek)

## 📝 快速开始完整示例

### 5分钟设置流程

1. **下载项目**
   ```bash
   git clone https://github.com/DrayChou/gaccode-statusline.git ~/.claude/scripts/gaccode.com
   cd ~/.claude/scripts/gaccode.com
   ```

2. **安全配置 GAC token**
   
   **方式1: 环境变量**（推荐）
   ```bash
   # 设置环境变量
   export GAC_LOGIN_TOKEN="your-actual-token-here"
   
   # 使用平台管理器安全配置
   # 请手动编辑 examples/launcher-config.json 文件配置API密钥
   # 安全提醒：避免在命令行中直接传递密钥
   ```
   
   **方式2: 配置文件**（本地开发）
   ```bash
   # 创建配置文件
   mkdir -p data/config
   
   # 编辑配置文件
   nano data/config/platform-config.json
   ```
   
   替换配置模板中的 `REPLACE-WITH-YOUR-ACTUAL-TOKEN` 为你的实际 token

3. **配置 Claude Code 状态栏**
   ```bash
   # 编辑 Claude Code 配置
   nano ~/.config/claude-code/config.json
   
   # 添加 statusLine 配置
   ```

4. **测试配置**
   ```bash
   # 测试状态栏基本功能
   echo '{"session_id":"test","model":{"display_name":"Test"}}' | python statusline.py
   
   # 测试优化的UUID前缀检测
   echo '{"session_id":"01abcdef-1234-5678-9012-123456789abc","model":{"display_name":"Test"}}' | python statusline.py
   
   # 验证平台配置（敏感信息会被屏蔽）
   python platform_manager.py list
   ```

5. **启动 Claude Code**
   ```bash
   claude
   ```

现在你应该看到带有 GAC 余额信息的状态栏了！🎉

**重点**: 快速开始模式直接编辑 `data/config/launcher-config.json`，无需启动脚本！

## 🔗 相关链接

- [GAC Code 官网](https://gaccode.com)
- [Claude Code 官方文档](https://docs.anthropic.com/claude/claude-code)
- [完整配置说明](./README.md)
- [问题反馈](https://github.com/DrayChou/issues)
