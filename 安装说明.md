# GAC Code 多平台状态栏插件 - 安装使用指南 v2.0

> **🚨 重要说明**: 本项目已于2025年10月分拆为两个独立的专用组件：
> - **[cc-status](https://github.com/DrayChou/cc-status)** - 专用状态栏管理器，显示所有平台余额信息
> - **[cc-launcher](https://github.com/DrayChou/cc-launcher)** - 专用多平台启动器，支持会话管理
>
> **🎯 推荐使用**: 新的分离架构提供更好的维护性和专用功能。本项目保留作为历史版本和参考实现。

## 📖 简介

GAC Code 多平台状态栏插件是一个采用**纯配置驱动**设计的 Claude Code 扩展。支持多个 AI 平台的实时余额显示，用户只需编辑配置文件即可管理所有功能。

## 🎯 设计理念

**核心原则**: 纯配置驱动，无命令依赖
- 用户只需编辑配置文件
- 系统自动检测和适配
- 无需记忆任何命令参数
- 智能模式自动切换

## ✨ v2.0 新特性

### 🏗️ 架构重构
- **纯配置驱动**: 移除所有不必要的CLI接口
- **统一配置管理**: 单一配置文件入口 `data/config/config.json`
- **智能模式检测**: 自动适配四种使用模式
- **环境变量优先**: 安全的凭证管理策略

### 🌟 核心功能
- **四种自动模式**: 零配置、基础、单平台、多平台
- **多平台支持**: GAC Code、DeepSeek、Kimi、SiliconFlow
- **实时状态显示**: 动态余额、会话成本、使用量统计
- **安全增强**: API密钥保护、敏感信息掩码

## 📦 快速安装

### 1. 系统要求

**必需组件**:
- **Claude Code** - 主程序
- **Python 3.7+** - 状态栏脚本运行环境
- **至少一个AI平台账号** - 用于获取API密钥

### 2. 下载安装

```bash
# 克隆项目到推荐位置
git clone https://github.com/DrayChou/gaccode-statusline.git ~/.claude/scripts/gaccode.com
cd ~/.claude/scripts/gaccode.com

# 或自定义位置
git clone https://github.com/DrayChou/gaccode-statusline.git
cd gaccode-statusline
```

### 3. 初始化配置

```bash
# 创建初始配置文件
python setup-config.py
```

这将创建 `data/config/config.json` 配置文件。

### 4. 配置Claude Code状态栏

编辑Claude Code配置文件：

**Windows**: `%APPDATA%\.config\claude-code\settings.json`  
**Mac/Linux**: `~/.config\claude-code\settings.json`

```json
{
  "statusLine": {
    "type": "command",
    "command": "python /path/to/gaccode-statusline/statusline.py",
    "refreshInterval": 1000
  }
}
```

### 5. 基础验证

```bash
# 测试状态栏基本功能
echo '{"session_id":"test"}' | python statusline.py
```

应该看到基本的状态栏显示（零配置模式）。

## ⚙️ 配置API密钥

### 配置API密钥：编辑配置文件

编辑 `data/config/config.json`：

```json
{
  "platforms": {
    "gaccode": {
      "name": "GAC Code",
      "api_base_url": "https://relay05.gaccode.com/claudecode",
      "api_key": "sk-your-api-key",
      "enabled": true
    },
    "deepseek": {
      "name": "DeepSeek",
      "api_base_url": "https://api.deepseek.com/anthropic", 
      "api_key": "sk-your-deepseek-key",
      "enabled": true
    }
  },
  "launcher": {
    "default_platform": "gaccode"
  },
  "statusline": {
    "show_balance": true,
    "show_model": true,
    "show_git_branch": true,
    "layout": "single_line"
  }
}
```

**安全提醒**: 配置文件已添加到 `.gitignore`，不会被意外提交到版本控制。

## 🎯 四种使用模式

### 1. 零配置模式 ⚫
- **自动触发**: 无API密钥配置时
- **显示内容**: 基本会话信息，无余额
- **适用场景**: 快速试用、演示

```bash
# 显示示例
Model:Claude-3.5-Sonnet Time:13:24:15 Git:main Dir:myproject
```

### 2. 基础模式 🔵  
- **自动触发**: 仅配置GAC Code API密钥时
- **显示内容**: GAC Code余额 + 基本信息
- **适用场景**: 只使用GAC Code的用户

```bash
# 显示示例
Model:Claude-3.5-Sonnet Time:13:24:15 GAC.B:2692/12000 Git:main Dir:myproject
```

### 3. 单平台模式 🟢
- **自动触发**: 设置默认平台和对应API密钥时
- **显示内容**: 指定平台余额 + 基本信息
- **适用场景**: 主要使用某个特定平台

```bash
# DeepSeek示例
Model:deepseek-v3.1 Time:13:24:15 Balance:¥45.60/¥100 Git:main Dir:myproject
```

### 4. 多平台模式 🟡
- **手动触发**: 配置多平台 + 使用启动脚本
- **显示内容**: 动态平台余额 + 基本信息  
- **适用场景**: 需要在多个平台间切换

```bash
# 平台切换使用
./bin/cc.mp.sh deepseek    # 使用DeepSeek
./bin/cc.mp.sh kimi        # 使用Kimi
./bin/cc.mp.sh dp          # DeepSeek简写
```

## 🛠️ 个性化配置

### 显示项目配置

编辑 `data/config/config.json` 中的 `statusline` 部分：

```json
{
  "statusline": {
    "show_balance": true,          // 显示余额信息
    "show_model": true,            // 显示AI模型名
    "show_directory": true,        // 显示当前目录
    "show_git_branch": true,       // 显示Git分支
    "show_time": true,             // 显示当前时间
    "show_session_cost": true,     // 显示会话成本
    "show_today_usage": true,      // 显示今日使用量
    "layout": "single_line"        // 布局方式
  }
}
```

### 平台设置

```json
{
  "launcher": {
    "default_platform": "deepseek"  // 设置默认平台
  }
}
```

## 🧪 验证安装

### 配置验证

```bash
# 验证配置文件格式
python -c "import json; print('✅ 配置有效' if json.load(open('data/config/config.json')) else '❌ 配置无效')"

# 验证配置文件
python -c "from config import get_config_manager; cm = get_config_manager(); print('✅ API密钥已加载' if cm.get_platform_config('gaccode', {}).get('api_key') else '⚪ 无API密钥')"
```

### 功能测试

```bash
# 测试基本功能
echo '{"session_id":"test"}' | python statusline.py

# 测试平台检测（DeepSeek前缀）
echo '{"session_id":"02abcdef-1234-5678-9012-123456789abc"}' | python statusline.py
```

### 成功标志

正确配置后，应该看到类似输出：

```bash
# 零配置模式
Model:Claude-3.5-Sonnet Time:13:24:15 Git:main

# 配置API密钥后
Model:Claude-3.5-Sonnet Time:13:24:15 GAC.B:2692/12000 Git:main
```

## 🔧 高级功能

### 平台切换

```bash
# 临时切换到不同平台
./bin/cc.mp.sh deepseek    # 使用DeepSeek
./bin/cc.mp.sh kimi        # 使用Kimi
./bin/cc.mp.sh gc          # 使用GAC Code

# 会话继续
./bin/cc.mp.sh --continue           # 继续默认平台会话
./bin/cc.mp.sh deepseek --continue  # 继续DeepSeek会话
```

## ❓ 故障排除

### Q: 状态栏不显示？

**检查项目**:
1. Python路径是否正确
2. statusline.py文件路径是否正确
3. Claude Code配置是否保存
4. 文件权限是否足够

**调试方法**:
```bash
# 测试Python环境
python --version

# 测试脚本基本功能
echo '{}' | python statusline.py
```

### Q: 没有余额信息？

**检查项目**:
1. API密钥是否正确配置
2. 网络连接是否正常  
3. 平台API是否可用

**调试方法**:
```bash
# 检查配置文件内容
python -c "from config import get_config_manager; cm = get_config_manager(); print('API Key configured:', bool(cm.get_platform_config('gaccode', {}).get('api_key')))"

# 测试配置加载
python -c "from config import get_config_manager; print('✅ 配置已加载' if get_config_manager() else '❌ 配置失败')"
```

### Q: 如何更新到v2.0？

**迁移步骤**:
1. 备份现有配置
2. 下载v2.0版本
3. 将旧配置迁移到 `data/config/config.json`
4. 在配置文件中直接设置API密钥
5. 停止使用所有 `python xxx.py --command` 形式的命令

## 🚀 获得支持

### 学习资源
- 📖 [完整文档](README.md)
- 🚀 [快速开始](快速开始.md)
- 📋 [配置指南](CONFIGURATION_GUIDE.md)
- 🏗️ [项目架构](PROJECT_STRUCTURE.md)

### 问题反馈
- 🐛 GitHub Issues - 报告Bug
- 💬 GitHub Discussions - 功能建议
- 📧 Email - 私人问题

---

**v2.0设计理念**: 纯配置驱动，无命令依赖。编辑配置文件，系统自动工作！🎉